# 数仓理论

## （一）数据仓库

### 1、什么是数据仓库

-   信息仓库：`Information WareHouse`

-   数据仓库

    >   Data Warehouse

    -   概念来自 Gill Inmon

    >   数据仓库是一个面向主题的、集成的、相对稳定的、反应历史变化的数据集合。

### 2、数仓四大特征

1.  面向主题的 *Subject Oriented*
2.  集成的 *Integrated*
3.  相对稳定的 *Non-Volatile*
4.  反映历史变化的 *Time Variant*

### 3、数仓与数据库的区别

-   数仓与数据库的比较相当于 OLTP 与 OLAP的比较
    -   OLTP，On-Line Transaction Processing
    -   OLAP，On-Line Analytical Processing
-   数仓目的是**分析数据**；数据库目的是**捕获和存储数据**
-   数仓有意引入数据冗余，反范式；数据库尽量避免冗余（第三范式）

*总之，数仓是在数据库早已大量存在的情况下，为了进一步挖掘数据资源以便更好地决策而产生的，绝不是所谓的大型数据库。*

<img src="D:\BigData-Camp\项目一\image\image-20210205113001750.png" alt="image-20210205113001750" style="zoom: 50%;" />

### 4、数据集市

-   数据集市是数据仓库中根据不同子主题创建的局部性数据组织，也成部门数据仓库，是数据仓库的一部分。
-   公司发展初期效果很好，但是到了后期，各个事业部独立建设的各个数据集市彼此之间建设标准不同，相互孤立，因此形成众多的数据孤岛，阻碍企业进一步发展。

## （二）数据建模方法

### 1、ER模型

-   ER，Entity Relationship（实体关系）
-   自上而下建模，从高度抽象到具体细节
-   建设周期长，对建模人员要求非常高

### 2、维度模型

-   从分析决策的需求出发，为分析需求服务，重点关注的是：用户如何更快速地完成需求分析，以及具有较好的大规模查询的相应性能
-   典型代表：星星模型，特殊场景下的雪花模型
-   企业建设数据仓库的经验表明：ER建模风险很大，维度模型更适合快速变化的业务。

## （三）数仓分层

-   数仓分层的好处：

    -   数据结构清晰
    -   复杂问题简单化
    -   减少重复开发
    -   屏蔽原始数据的异常
    -   数据血缘的追踪

-   数仓通常分为三层：**数据操作层**、**数据仓库层**、**应用数据层**（数据集市层）

    <img src="D:\BigData-Camp\项目一\image\image-20210205115633120.png" alt="image-20210205115633120" style="zoom:50%;" />

-   **ODS（Operation Data Store）**，数仓源头系统的数据会**原封不动地存储一份**，称为ODS层，也称准备区。它们是后续数据仓库层加工数据的来源。主要包括：
    -   **业务数据库**：用DataX、Sqoop等定时抽取；在实时应用中，可用Canal监听MySql的BinLog，实时接入变更的数据。
    -   **埋点日志**：线上系统会打入各种日志，这些日志一般以文件的形式保存，可用Flume定时抽取
    -   **其他数据源**：第三方购买、爬虫

-   **DW（Data Warehouse）**，包括DWD、DWS、DIM层，是由ODS层数据加工而成的。
    -   **DWD（Data Warehouse Detail）**，是业务层与数仓的隔离层。以***业务过程*** 作为建模驱动，基于业务具体过程，构建<u>细粒度</u>的**细层事实表**，也可做宽表化处理。
    -   **DWS（Data Warehouse Service）**，基于DWD的基础数据，整合汇总成分析某一主题域的服务数据。以***分析的主题*** 为建模驱动，基于上层应用的指标需求，构建<u>公共粒度</u>的**汇总指标事实表**。
    -   **DIM（公共维度层）**：基于维度建模思想，建立一致性维度；
    -   **TMP层**：临时层，存放计算过程中产生的临时数据

-   **ADS（Application Data Store）**，基于DW的数据，汇总整合成主题域的服务数据，用于后续的业务查询和分析等。

## （四）数仓模型























